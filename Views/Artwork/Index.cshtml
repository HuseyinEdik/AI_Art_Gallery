@model IEnumerable<AI_Art_Gallery.Models.Artwork>

@{
    ViewData["Title"] = "Galeri";
}

<div class="text-center mb-5">
    <h1 class="display-5 fw-bold text-white">İlham Veren Promptlar</h1>
    <p class="text-secondary">Topluluk tarafından oluşturulan en iyi AI görsellerini keşfet.</p>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fa-solid fa-check-circle me-2"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["InfoMessage"] != null)
{
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        <i class="fa-solid fa-info-circle me-2"></i> @TempData["InfoMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fa-solid fa-exclamation-circle me-2"></i> @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="row">
    @if (Model == null || !Model.Any())
    {
        <div class="text-center py-5">
            <div class="mb-4">
                <i class="fa-regular fa-images fa-4x text-secondary opacity-25"></i>
            </div>
            <h3 class="text-white">Henüz hiç görsel yüklenmedi.</h3>
        </div>
    }
    else
    {
        @foreach (var item in Model)
        {
            <partial name="_ArtworkCard" model="item" />
        }
    }
</div>

<!-- ML Laboratuvarı Floating Button -->
<a asp-controller="ML" asp-action="Index"
   class="position-fixed bottom-0 start-0 m-4 d-flex align-items-center justify-content-center text-decoration-none shadow-lg floating-btn"
   style="width: 60px; height: 60px; background: linear-gradient(135deg, #00f260 0%, #0575E6 100%); border-radius: 50%; z-index: 998;"
   title="ML Laboratuvarına Git">
    <i class="fa-solid fa-microchip text-white fs-3"></i>
</a>

<!-- Hava Durumu Floating Button -->
<button id="weatherBtn" 
        class="position-fixed bottom-0 end-0 m-4 d-flex align-items-center justify-content-center border-0 shadow-lg floating-btn"
        style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; z-index: 998;"
        title="Hava Durumu">
    <i class="fa-solid fa-cloud-sun text-white fs-3"></i>
</button>

<!-- Hava Durumu Modal Penceresi -->
<div id="weatherModal" class="weather-modal" style="display: none;">
    <div class="weather-modal-content">
        <div class="weather-modal-header">
            <h5 class="mb-0">
                <i class="fa-solid fa-location-dot me-2"></i>Hava Durumu
            </h5>
            <button id="closeWeatherBtn" class="btn-close btn-close-white"></button>
        </div>
        
        <div id="weatherLoading" class="text-center py-5">
            <div class="spinner-border text-primary mb-3" role="status"></div>
            <p class="text-secondary">Hava durumu yükleniyor...</p>
        </div>
        
        <div id="weatherContent" class="weather-modal-body" style="display: none;">
            <div class="text-center mb-4">
                <div class="weather-icon-large mb-3">
                    <i id="weatherIcon" class="fa-solid fa-cloud-sun" style="font-size: 4rem;"></i>
                </div>
                <h2 id="weatherTemp" class="display-3 fw-bold text-white mb-0">--°C</h2>
                <p id="weatherDesc" class="text-secondary mb-0">--</p>
            </div>
            
            <div class="weather-location mb-4">
                <h4 id="weatherCity" class="text-white fw-bold">
                    <i class="fa-solid fa-map-marker-alt me-2"></i>--
                </h4>
            </div>
            
            <div class="weather-details">
                <div class="row g-3">
                    <div class="col-6">
                        <div class="weather-detail-card">
                            <i class="fa-solid fa-droplet text-info"></i>
                            <span class="ms-2">Nem</span>
                            <strong id="weatherHumidity" class="d-block mt-1">--%</strong>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="weather-detail-card">
                            <i class="fa-solid fa-wind text-success"></i>
                            <span class="ms-2">Rüzgar</span>
                            <strong id="weatherWind" class="d-block mt-1">-- km/h</strong>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="weather-detail-card">
                            <i class="fa-solid fa-gauge text-warning"></i>
                            <span class="ms-2">Basınç</span>
                            <strong id="weatherPressure" class="d-block mt-1">-- hPa</strong>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="weather-detail-card">
                            <i class="fa-solid fa-eye text-primary"></i>
                            <span class="ms-2">Görüş</span>
                            <strong id="weatherVisibility" class="d-block mt-1">-- km</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="weatherError" class="text-center py-5" style="display: none;">
            <i class="fa-solid fa-exclamation-triangle fa-3x text-danger mb-3"></i>
            <p class="text-danger">Hava durumu yüklenemedi.</p>
            <button class="btn btn-outline-danger btn-sm" onclick="loadWeather()">Tekrar Dene</button>
        </div>
    </div>
</div>

<style>
    .floating-btn {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
    }

    .floating-btn:hover {
        transform: scale(1.1) rotate(10deg);
        box-shadow: 0 8px 20px rgba(187, 134, 252, 0.4) !important;
    }

    .weather-modal {
        position: fixed;
        bottom: 80px;
        right: 20px;
        z-index: 999;
        animation: slideIn 0.3s ease;
    }

    @@keyframes slideIn {
        from {
            transform: translateY(20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .weather-modal-content {
        background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
        border: 1px solid #444;
        border-radius: 20px;
        width: 350px;
        max-width: 90vw;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        overflow: hidden;
    }

    .weather-modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: white;
    }

    .weather-modal-body {
        padding: 25px;
    }

    .weather-icon-large {
        background: rgba(102, 126, 234, 0.1);
        width: 100px;
        height: 100px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .weather-detail-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }

    .weather-detail-card:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
    }

    .weather-location {
        text-align: center;
        padding: 15px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 10px;
    }

    @@media (max-width: 768px) {
        .weather-modal {
            right: 10px;
            bottom: 70px;
        }
        
        .weather-modal-content {
            width: 320px;
        }
    }
</style>

<script>
const WEATHER_API_KEY = 'f7d34499d52d8641eac7f22d7d91c748'; // OpenWeatherMap API key
let weatherModalOpen = false;

    document.getElementById('weatherBtn').addEventListener('click', function() {
        const modal = document.getElementById('weatherModal');
        
        if (!weatherModalOpen) {
            modal.style.display = 'block';
            weatherModalOpen = true;
            loadWeather();
        } else {
            closeWeatherModal();
        }
    });

    document.getElementById('closeWeatherBtn').addEventListener('click', closeWeatherModal);

    function closeWeatherModal() {
        document.getElementById('weatherModal').style.display = 'none';
        weatherModalOpen = false;
    }

    // Modal dışına tıklayınca kapat
    document.addEventListener('click', function(event) {
        const modal = document.getElementById('weatherModal');
        const btn = document.getElementById('weatherBtn');
        
        if (weatherModalOpen && 
            !modal.contains(event.target) && 
            !btn.contains(event.target)) {
            closeWeatherModal();
        }
    });

    async function loadWeather() {
        const loading = document.getElementById('weatherLoading');
        const content = document.getElementById('weatherContent');
        const error = document.getElementById('weatherError');

        loading.style.display = 'block';
        content.style.display = 'none';
        error.style.display = 'none';

        try {
            // Kullanıcının konumunu al
            if (!navigator.geolocation) {
                throw new Error('Tarayıcınız konum bilgisini desteklemiyor');
            }

            const position = await new Promise((resolve, reject) => {
                navigator.geolocation.getCurrentPosition(resolve, reject);
            });

            const { latitude, longitude } = position.coords;

            // OpenWeatherMap API'den hava durumu al
            const response = await fetch(
                `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&units=metric&lang=tr&appid=${WEATHER_API_KEY}`
            );

            if (!response.ok) {
                throw new Error('Hava durumu API hatası');
            }

            const data = await response.json();

            // Verileri göster
            document.getElementById('weatherTemp').textContent = Math.round(data.main.temp) + '°C';
            document.getElementById('weatherDesc').textContent = data.weather[0].description.charAt(0).toUpperCase() + data.weather[0].description.slice(1);
            document.getElementById('weatherCity').innerHTML = `<i class="fa-solid fa-map-marker-alt me-2"></i>${data.name}, ${data.sys.country}`;
            document.getElementById('weatherHumidity').textContent = data.main.humidity + '%';
            document.getElementById('weatherWind').textContent = Math.round(data.wind.speed * 3.6) + ' km/h';
            document.getElementById('weatherPressure').textContent = data.main.pressure + ' hPa';
            document.getElementById('weatherVisibility').textContent = (data.visibility / 1000).toFixed(1) + ' km';

            // İkon değiştir
            const iconMap = {
                '01d': 'fa-sun',
                '01n': 'fa-moon',
                '02d': 'fa-cloud-sun',
                '02n': 'fa-cloud-moon',
                '03d': 'fa-cloud',
                '03n': 'fa-cloud',
                '04d': 'fa-cloud',
                '04n': 'fa-cloud',
                '09d': 'fa-cloud-showers-heavy',
                '09n': 'fa-cloud-showers-heavy',
                '10d': 'fa-cloud-sun-rain',
                '10n': 'fa-cloud-moon-rain',
                '11d': 'fa-bolt',
                '11n': 'fa-bolt',
                '13d': 'fa-snowflake',
                '13n': 'fa-snowflake',
                '50d': 'fa-smog',
                '50n': 'fa-smog'
            };

            const iconClass = iconMap[data.weather[0].icon] || 'fa-cloud';
            document.getElementById('weatherIcon').className = `fa-solid ${iconClass}`;

            loading.style.display = 'none';
            content.style.display = 'block';

        } catch (err) {
            console.error('Hava durumu hatası:', err);
            loading.style.display = 'none';
            error.style.display = 'block';
        }
    }
</script>